"use strict";var Qe=Object.create;var G=Object.defineProperty;var je=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var qe=Object.getPrototypeOf,Xe=Object.prototype.hasOwnProperty;var ze=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Je=(r,e)=>{for(var t in e)G(r,t,{get:e[t],enumerable:!0})},X=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ze(e))!Xe.call(r,n)&&n!==t&&G(r,n,{get:()=>e[n],enumerable:!(o=je(e,n))||o.enumerable});return r};var R=(r,e,t)=>(t=r!=null?Qe(qe(r)):{},X(e||!r||!r.__esModule?G(t,"default",{value:r,enumerable:!0}):t,r)),et=r=>X(G({},"__esModule",{value:!0}),r);var Ae=ze((kt,Pe)=>{var Q=require("util"),pt=require("path"),A=require("child_process").spawn,w=function(){},j="HKLM",de="HKCU",fe="HKCR",me="HKU",he="HKCC",ge=[j,de,fe,me,he],ve="REG_SZ",Ee="REG_MULTI_SZ",ye="REG_EXPAND_SZ",_e="REG_DWORD",we="REG_QWORD",Re="REG_BINARY",Se="REG_NONE",xe=[ve,Ee,ye,_e,we,Re,Se],ct="",ut=/(\\[a-zA-Z0-9_\s]+)*/,lt=/^(HKEY_LOCAL_MACHINE|HKEY_CURRENT_USER|HKEY_CLASSES_ROOT|HKEY_USERS|HKEY_CURRENT_CONFIG)(.*)$/,Te=/^(.*)\s(REG_SZ|REG_MULTI_SZ|REG_EXPAND_SZ|REG_DWORD|REG_QWORD|REG_BINARY|REG_NONE)\s+([^\s].*)$/;function O(r,e){if(!(this instanceof O))return new O(r,e);Error.captureStackTrace(this,O),this.__defineGetter__("name",function(){return O.name}),this.__defineGetter__("message",function(){return r}),this.__defineGetter__("code",function(){return e})}Q.inherits(O,Error);function I(r){var e={stdout:"",stderr:""};return r.stdout.on("data",function(t){e.stdout+=t.toString()}),r.stderr.on("data",function(t){e.stderr+=t.toString()}),e}function C(r,e,t){var o=t.stdout.trim(),n=t.stderr.trim(),a=Q.format(`%s command exited with code %d:
%s
%s`,r,e,o,n);return new O(a,e)}function dt(r){if(r=="x64")return"64";if(r=="x86")return"32";throw new Error("illegal architecture: "+r+" (use x86 or x64)")}function D(r,e){e&&r.push("/reg:"+dt(e))}function b(){return process.platform==="win32"?pt.join(process.env.windir,"system32","reg.exe"):"REG"}function M(r,e,t,o,n,a,i){if(!(this instanceof M))return new M(r,e,t,o,n,a,i);var s=r,c=e,p=t,m=o,l=n,E=a,d=i;this.__defineGetter__("host",function(){return s}),this.__defineGetter__("hive",function(){return c}),this.__defineGetter__("key",function(){return p}),this.__defineGetter__("name",function(){return m}),this.__defineGetter__("type",function(){return l}),this.__defineGetter__("value",function(){return E}),this.__defineGetter__("arch",function(){return d})}Q.inherits(M,Object);function u(r){if(!(this instanceof u))return new u(r);var e=r||{},t=""+(e.host||""),o=""+(e.hive||j),n=""+(e.key||""),a=e.arch||null;if(this.__defineGetter__("host",function(){return t}),this.__defineGetter__("hive",function(){return o}),this.__defineGetter__("key",function(){return n}),this.__defineGetter__("path",function(){return(t.length==0?"":"\\\\"+t+"\\")+o+n}),this.__defineGetter__("arch",function(){return a}),this.__defineGetter__("parent",function(){var i=n.lastIndexOf("\\");return new u({host:this.host,hive:this.hive,key:i==-1?"":n.substring(0,i),arch:this.arch})}),ge.indexOf(o)==-1)throw new Error("illegal hive specified.");if(!ut.test(n))throw new Error("illegal key specified.");if(a&&a!="x64"&&a!="x86")throw new Error("illegal architecture specified (use x86 or x64)")}u.HKLM=j;u.HKCU=de;u.HKCR=fe;u.HKU=me;u.HKCC=he;u.HIVES=ge;u.REG_SZ=ve;u.REG_MULTI_SZ=Ee;u.REG_EXPAND_SZ=ye;u.REG_DWORD=_e;u.REG_QWORD=we;u.REG_BINARY=Re;u.REG_NONE=Se;u.REG_TYPES=xe;u.DEFAULT_VALUE=ct;u.prototype.values=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["QUERY",this.path];D(t,this.arch);var o=A(b(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),n="",a=this,i=null,s=I(o);return o.on("close",function(c){if(!i)if(c!==0)w("process exited with code "+c),e(C("QUERY",c,s),null);else{for(var p=[],m=[],l=n.split(`
`),E=0,d=0,g=l.length;d<g;d++){var y=l[d].trim();y.length>0&&(w(y),E!=0&&p.push(y),++E)}for(var d=0,g=p.length;d<g;d++){var _=Te.exec(p[d]),f,h,v;_&&(f=_[1].trim(),h=_[2].trim(),v=_[3],m.push(new M(a.host,a.hive,a.key,f,h,v,a.arch)))}e(null,m)}}),o.stdout.on("data",function(c){n+=c.toString()}),o.on("error",function(c){i=c,e(c)}),this};u.prototype.keys=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["QUERY",this.path];D(t,this.arch);var o=A(b(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),n="",a=this,i=null,s=I(o);return o.on("close",function(c){i||c!==0&&(w("process exited with code "+c),e(C("QUERY",c,s),null))}),o.stdout.on("data",function(c){n+=c.toString()}),o.stdout.on("end",function(){for(var c=[],p=[],m=n.split(`
`),l=0,E=m.length;l<E;l++){var d=m[l].trim();d.length>0&&(w(d),c.push(d))}for(var l=0,E=c.length;l<E;l++){var g=lt.exec(c[l]),y,_;g&&(y=g[1],_=g[2],_&&_!==a.key&&p.push(new u({host:a.host,hive:a.hive,key:_,arch:a.arch})))}e(null,p)}),o.on("error",function(c){i=c,e(c)}),this};u.prototype.get=function(e,t){if(typeof t!="function")throw new TypeError("must specify a callback");var o=["QUERY",this.path];e==""?o.push("/ve"):o=o.concat(["/v",e]),D(o,this.arch);var n=A(b(),o,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),a="",i=this,s=null,c=I(n);return n.on("close",function(p){if(!s)if(p!==0)w("process exited with code "+p),t(C("QUERY",p,c),null);else{for(var m=[],l=null,E=a.split(`
`),d=0,g=0,y=E.length;g<y;g++){var _=E[g].trim();_.length>0&&(w(_),d!=0&&m.push(_),++d)}var f=m[m.length-1]||"",h=Te.exec(f),v,T,K;h&&(v=h[1].trim(),T=h[2].trim(),K=h[3],l=new M(i.host,i.hive,i.key,v,T,K,i.arch)),t(null,l)}}),n.stdout.on("data",function(p){a+=p.toString()}),n.on("error",function(p){s=p,t(p)}),this};u.prototype.set=function(e,t,o,n){if(typeof n!="function")throw new TypeError("must specify a callback");if(xe.indexOf(t)==-1)throw Error("illegal type specified.");var a=["ADD",this.path];e==""?a.push("/ve"):a=a.concat(["/v",e]),a=a.concat(["/t",t,"/d",o,"/f"]),D(a,this.arch);var i=A(b(),a,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s=null,c=I(i);return i.on("close",function(p){s||(p!==0?(w("process exited with code "+p),n(C("ADD",p,c,null))):n(null))}),i.stdout.on("data",function(p){w(""+p)}),i.on("error",function(p){s=p,n(p)}),this};u.prototype.remove=function(e,t){if(typeof t!="function")throw new TypeError("must specify a callback");var o=e?["DELETE",this.path,"/f","/v",e]:["DELETE",this.path,"/f","/ve"];D(o,this.arch);var n=A(b(),o,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),a=null,i=I(n);return n.on("close",function(s){a||(s!==0?(w("process exited with code "+s),t(C("DELETE",s,i),null)):t(null))}),n.stdout.on("data",function(s){w(""+s)}),n.on("error",function(s){a=s,t(s)}),this};u.prototype.clear=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["DELETE",this.path,"/f","/va"];D(t,this.arch);var o=A(b(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),n=null,a=I(o);return o.on("close",function(i){n||(i!==0?(w("process exited with code "+i),e(C("DELETE",i,a),null)):e(null))}),o.stdout.on("data",function(i){w(""+i)}),o.on("error",function(i){n=i,e(i)}),this};u.prototype.erase=u.prototype.clear;u.prototype.destroy=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["DELETE",this.path,"/f"];D(t,this.arch);var o=A(b(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),n=null,a=I(o);return o.on("close",function(i){n||(i!==0?(w("process exited with code "+i),e(C("DELETE",i,a),null)):e(null))}),o.stdout.on("data",function(i){w(""+i)}),o.on("error",function(i){n=i,e(i)}),this};u.prototype.create=function(e){if(typeof e!="function")throw new TypeError("must specify a callback");var t=["ADD",this.path,"/f"];D(t,this.arch);var o=A(b(),t,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),n=null,a=I(o);return o.on("close",function(i){n||(i!==0?(w("process exited with code "+i),e(C("ADD",i,a),null)):e(null))}),o.stdout.on("data",function(i){w(""+i)}),o.on("error",function(i){n=i,e(i)}),this};u.prototype.keyExists=function(e){return this.values(function(t,o){if(t)return t.code==1?e(null,!1):e(t);e(null,!0)}),this};u.prototype.valueExists=function(e,t){return this.get(e,function(o,n){if(o)return o.code==1?t(null,!1):t(o);t(null,!0)}),this};Pe.exports=u});var yt={};Je(yt,{activate:()=>Et});module.exports=et(yt);var q=R(require("vscode"));var P=require("vscode"),S=R(require("vscode"));var Y="app.R",tt=/^([\w|\s]+)([\.[\w|^\.]*]*)$/i;function B(r){if(r==="")return{valid:!0,name:Y};let e=r.match(tt);if(e===null)return{valid:!1,msg:`Invalid app name: ${r}.`};let[t,o,n]=e;return(n===""||n===".")&&(n=".R"),o?n!==".R"?{valid:!1,msg:`Invalid file extension: ${n}. Extension needs to be .R`}:(o=o.replaceAll(" ","-"),{valid:!0,name:`${o}${n}`}):{valid:!1,msg:`Invalid app name: ${r}. Make sure to only use numbers and letters. Spaces will be converted to dashes.`}}var z=new TextEncoder().encode("");async function J(){let r=await P.window.showOpenDialog({canSelectFolders:!0,canSelectFiles:!0,title:"Choose location for Shiny app",openLabel:"Choose app folder or file",canSelectMany:!1,filters:{"R scripts":["R","r"]}});if(!r)return;let e=r[0],o=(await S.workspace.fs.stat(e)).type===S.FileType.Directory?await rt(e):e;o&&S.commands.executeCommand("vscode.openWith",o,"shinyuieditor.appFile")}async function rt(r){let e=(await P.workspace.fs.readDirectory(r)).filter(([i,s])=>s===S.FileType.File).map(([i,s])=>i),t=await P.window.showInputBox({prompt:"Enter file name for new app",placeHolder:Y,validateInput(i){let s=B(i);return s.valid?e.includes(s.name)?{message:`Run the editor on existing app: ${s.name}.`,severity:S.InputBoxValidationSeverity.Info}:{message:`Run the template chooser to build new app: ${s.name}.`,severity:S.InputBoxValidationSeverity.Info}:{message:s.msg,severity:S.InputBoxValidationSeverity.Error}}});if(!t)return;let o=B(t);if(!o.valid){S.window.showErrorMessage(`Error processing requested file name: ${t}. Try with a different name.`);return}let n=P.Uri.joinPath(r,o.name);return e.includes(o.name)||await P.workspace.fs.writeFile(n,z),n}var ee=R(require("vscode")),V=require("vscode");function te(r="world"){let e=V.window.activeTextEditor;if(!e){V.window.showErrorMessage("No active file open to run ui editor on!");return}ee.commands.executeCommand("vscode.openWith",e.document.uri,"shinyuieditor.appFile")}var x=R(require("vscode"));function ot(r){return r==="python"?"PYTHON":r==="r"?"R":"OTHER"}function re(r){let e=ot(r.languageId);if(e==="OTHER")return{status:"invalid",reason:"The editor currently only supports R and Python."};let t=r.getText();return t.trim()===""?{status:"empty",lang:e}:e==="R"?nt(t):st(t)}function nt(r){return it.test(r)?{status:"valid",lang:"R"}:{status:"invalid",reason:"Script doesn't appear to be a shiny app. Please start with a template or add a shinyApp() call."}}var it=/shinyApp\(/;function st(r){return r.includes("from shiny")?{status:"valid",lang:"PYTHON"}:{status:"invalid",reason:"Script doesn't appear to be a shiny app. Please start with a template or make sure you're importing shiny."}}function oe(r){return typeof r=="object"&&r!==null}function ne(r){return oe(r)?"path"in r:!1}var ie=at;function at(r,e,t){var o=null,n=null,a=function(){o&&(clearTimeout(o),n=null,o=null)},i=function(){var c=n;a(),c&&c()},s=function(){if(!e)return r.apply(this,arguments);var c=this,p=arguments,m=t&&!o;if(a(),n=function(){r.apply(c,p)},o=setTimeout(function(){if(o=null,!m){var l=n;return n=null,l()}},e),m)return n()};return s.cancel=a,s.flush=i,s}var L=R(require("vscode"));var se=require("child_process");async function ae(r,e,t={}){let o="";return new Promise(n=>{let a=new AbortController,{signal:i}=a,s=(0,se.spawn)(r,e,{signal:i});s.on("spawn",m),s.on("error",l),s.on("close",E),s.stdout.on("data",d),s.stderr.on("data",g);function c(h,v){o+=`${h}: ${v}`}function p(h){t.verbose&&console.log(`%c[RProc ${s.pid}] %c${h.replaceAll(/\n$/g,"").replaceAll(/\n/g,`
\u2219\u2219\u2219 `)}`,"color: orangered;","color: grey; opacity: 0.5")}function m(){p("spawned"),clearTimeout(f),n({proc:s,stop:_,getIsRunning:()=>s.exitCode===null})}function l(h){var v;p(`Error: 
${h.toString()}`),clearTimeout(f),(v=t.onError)==null||v.call(t,h)}function E(){var h;p("Closed"),clearTimeout(f),(h=t.onClose)==null||h.call(t)}function d(h){var T;let v=h.toString();p(`stdout: 
${v}`),c("out",v),(T=t.onStdout)==null||T.call(t,v)}function g(h){var T;let v=h.toString();p(`stderr: ${v}`),c("error",v),(T=t.onStderr)==null||T.call(t,v)}function y(){s.off("spawn",m),s.off("error",l),s.off("close",E),s.stdout.off("data",d),s.stderr.off("data",g)}function _(){return y(),!s.pid||!s.connected?!0:(p(`Killing R process ${s.pid}`),process.kill(s.pid))}let f=setTimeout(()=>{throw _(),new Error(`Starting backend server failed.
 Logs:
`+o)},t.timeout_ms??5e3)})}var $=R(require("vscode"));async function pe(){var t;let r=$.extensions.getExtension("ms-python.python");if(!r)throw new Error("Python extension needed for previewing Python apps");return(await r.exports.environment.getExecutionDetails((t=$.window.activeTextEditor)==null?void 0:t.document.uri)).execCommand.join(" ")}async function ce({pathToApp:r,port:e,host:t}){let o=new RegExp("application startup complete.","i");return{path_to_executable:await pe(),startup_cmds:["-m","shiny","run","--port",`${e}`,"--host",t,"--reload",r.replace(/([\\"])/g,"\\$1")],get_is_ready:n=>o.test(n)}}function ue(...r){return r.filter(t=>t!==void 0).reduce((t,o,n)=>(n===0?"":t+`
`)+o,"")}function le(r){return r.replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var be=require("fs");var Ce=require("fs"),Z=R(require("path")),Ie=Ae();async function De(){let r=process.platform,e=ft(r);if(!e&&r==="win32")try{let t=new Ie({hive:Ie.HKLM,key:"\\Software\\R-Core\\R"}),o=await new Promise((n,a)=>t.get("InstallPath",(i,s)=>i===null?n(s):a(i)));e=Z.default.join(o.value,"bin","R.exe")}catch{e=""}return e}function ft(r){let e=":",t="";r==="win32"&&(e=";",t=".exe");let o=process.env.PATH?process.env.PATH.split(e):[];for(let n of o){let a=Z.default.join(n,"R"+t);if((0,Ce.existsSync)(a))return a}return""}async function Le(){let r=await De();if(!r){let e="Cannot find R for running shinyuieditor. Make sure R is installed and/or updating the shinyuieditor extension settings option to proper to R path.";throw new Error(e)}if(!(0,be.existsSync)(r)){let e=`Path to R is invalid: ${r}. Make sure R is installed and/or updating the shinyuieditor extension settings option to proper to R path.`;throw new Error(e)}return le(r)}async function Oe({pathToApp:r,port:e,host:t}){let o=new RegExp(`listening on .+${e}`,"i");return{path_to_executable:await Le(),startup_cmds:["--no-save","--no-restore","--silent","-e",ue("options(shiny.autoreload = TRUE)",`shiny::runApp(appDir = "${r}", port = ${e}, host = "${t}")`)],get_is_ready:a=>o.test(a)}}var Me=R(require("fs")),H=R(require("vscode"));var Ue=require("child_process");async function ke({cmd:r,args:e,verbose:t=!1,timeout_ms:o=1500}){let n=mt(t,"runShellCommand: ");return new Promise(a=>{let i={stdout:[],stderr:[]},s=(0,Ue.spawn)(r,e);function c(){n("Spawned")}function p(y){n("Error "+y.message),d(),a({status:"error",errorMsgs:y.message,...i})}function m(){n("Close"),d(),a({status:"success",...i})}function l(y){n(`stdout: ${y.toString()}`),i.stdout.push(y.toString())}function E(y){n(`stderr: ${y.toString()}`),i.stderr.push(y.toString())}function d(){clearTimeout(g),s.off("spawn",c),s.off("error",p),s.off("close",m),s.stdout.off("data",l),s.stderr.off("data",E)}let g=setTimeout(()=>{a({status:"error",errorMsgs:`Command, no response from run command within ${o}ms:
${r} ${e==null?void 0:e.join(" ")}`,...i}),d()},o);s.on("spawn",c),s.on("error",p),s.on("close",m),s.stdout.on("data",l),s.stderr.on("data",E)})}function mt(r,e){return t=>{r&&console.log(e+t)}}async function Ne(r){if(ht())return await gt(r);let e=H.Uri.parse(`http://localhost:${r}`);return(await H.env.asExternalUri(e)).toString()}var Fe="/usr/lib/rstudio-server/bin/rserver-url";function ht(){return"RS_SERVER_URL"in process.env?Me.existsSync(Fe):!1}async function gt(r){let e=await ke({cmd:Fe,args:[String(r)]});e.status==="error"&&Error(`Failed to get Posit workbench forwarded port. Error msg:
`+e.errorMsgs);let t=process.env.RS_SERVER_URL,o=process.env.RS_SESSION_URL;if(!t||!o)throw new Error("Can't find URL for workbench.");let n=e.stdout[0];return`${t}${o.slice(1)}p/${n}/`}async function Ge(r,e){let[t,o]=await Promise.all([Ne(e.port),r==="R"?Oe(e):ce(e)]);return{...o,previewAppUri:t}}var $e=R(require("net"));async function He(){return new Promise(r=>{let e=$e.default.createServer();e.listen(0,()=>{var o;let t=(o=e.address)==null?void 0:o.call(e);if(typeof t=="string"||t===null)throw new Error("Failed to find a free port...");e.close(n=>r(t.port))})})}function We({language:r,pathToApp:e,onCrash:t,onInitiation:o,onReady:n,onFailToStart:a,onLogs:i}){let s=null;async function c(){o(),p();try{let{path_to_executable:m,startup_cmds:l,get_is_ready:E,previewAppUri:d}=await Ge(r,{host:"0.0.0.0",pathToApp:e,port:await He()});return s=await ae(m,l,{onStderr(g){E(g)&&n(d),i(g.split(`
`))},onClose:t,onError:t}),!0}catch{return a(),!1}}function p(){return s===null?!0:s.stop()}return{start:c,stop:p}}var U=R(require("vscode"));async function Ke(r){let e=r.uri,t=new U.WorkspaceEdit,o=r.validateRange(new U.Range(0,0,1/0,1/0));t.replace(e,o,""),await U.workspace.applyEdit(t),r.save()}var N=R(require("vscode"));async function Ye({document:r,existingEditor:e}){return e&&N.window.visibleTextEditors.includes(e)?e:await N.window.showTextDocument(r.uri,{viewColumn:N.ViewColumn.Beside,preview:!0})}var k=R(require("vscode"));async function Be({script_text:r,document:e}){let t=e.getText();if(r===t)return!1;let o=e.uri,n=new k.WorkspaceEdit,a=e.validateRange(new k.Selection(0,0,e.lineCount+1,0));return n.replace(o,a,r),await k.workspace.applyEdit(n),e.save(),!0}var{showErrorMessage:ur}=L.window;async function Ve({language:r,document:e,sendMessage:t,convertFilePaths:o}){let n=!1,a=null,i,s;async function c(){}function p(){t({path:"TEMPLATE_CHOOSER",payload:"SINGLE-FILE"})}let m=async()=>{let f=e.getText();if(!(a!==null&&f.includes(a))){if(n||(await c(),t({path:"CHECKIN",payload:{language:r,server_aware:!0,app_preview:!0,path_to_ts_wasm:o("tree-sitter.wasm")}}),n=!0),f===""){p();return}try{a=f,t({path:"APP-SCRIPT-TEXT",payload:{language:r,app_type:"SINGLE-FILE",app:f}})}catch(v){console.error("Failed to parse",v)}}},l=ie(m,500),E=()=>{l()},d=()=>{l.flush()},g=We({language:r,pathToApp:e.fileName,onInitiation:()=>{t({path:"APP-PREVIEW-STATUS",payload:"LOADING"})},onReady:f=>{t({path:"APP-PREVIEW-STATUS",payload:{url:f}})},onFailToStart:()=>{t({path:"APP-PREVIEW-CRASH",payload:"Failed to start"})},onCrash:()=>{t({path:"APP-PREVIEW-CRASH",payload:"Crashed"})},onLogs:f=>{t({path:"APP-PREVIEW-LOGS",payload:f})}}),y=async()=>(i=await Ye({document:e,existingEditor:i}),i);return{onDocumentChanged:E,onDocumentSaved:d,onDidReceiveMessage:async f=>{if(ne(f))switch(f.path){case"READY-FOR-STATE":m();return;case"UPDATED-APP":{if(f.payload.app_type==="MULTI-FILE")return;await Be({script_text:f.payload.app,document:e})&&(a=f.payload.app);return}case"APP-PREVIEW-REQUEST":{g.start();return}case"APP-PREVIEW-STOP":{g.stop();return}case"APP-PREVIEW-RESTART":{g.start();return}case"ENTERED-TEMPLATE-SELECTOR":{g.stop(),await Ke(e);return}case"OPEN-COMPANION-EDITOR":{await y();return}case"INSERT-SNIPPET":{let h=f.payload.snippet,v=f.payload.insert_at;if(typeof v=="string")throw new Error("Need snippet location for insertion");await(await y()).insertSnippet(new L.SnippetString(h),new L.Position(v.row,v.column))||L.window.showErrorMessage("Failed to add output scaffold");return}default:console.warn("Unhandled message from client",f)}else console.warn("Unknown message from webview",f)}}}var W=class{constructor(e){this.context=e}static register(e){let t=new W(e);return x.window.registerCustomEditorProvider(W.viewType,t,{webviewOptions:{retainContextWhenHidden:!0}})}async resolveCustomTextEditor(e,t,o){let n=re(e);if(n.status==="invalid")throw x.window.showErrorMessage(n.reason),t.dispose(),new Error(n.reason);t.webview.options={enableScripts:!0},t.webview.html=this.getHtmlForWebview(t.webview);let a=await Ve({language:n.lang,document:e,sendMessage:p=>t.webview.postMessage(p),convertFilePaths:p=>t.webview.asWebviewUri(x.Uri.joinPath(this.context.extensionUri,"media",p)).toString()}),i=x.workspace.onDidChangeTextDocument(p=>{p.document.uri.toString()===e.uri.toString()&&a.onDocumentChanged()}),s=x.workspace.onDidSaveTextDocument(p=>{p.uri.toString()===e.uri.toString()&&a.onDocumentSaved()}),c=t.webview.onDidReceiveMessage(a.onDidReceiveMessage);t.onDidDispose(()=>{i.dispose(),s.dispose(),c.dispose()})}getHtmlForWebview(e){let t=e.asWebviewUri(x.Uri.joinPath(this.context.extensionUri,"media","build","extension-editor.js")),o=e.asWebviewUri(x.Uri.joinPath(this.context.extensionUri,"media","build","style.css")),n=vt();return`
			<!DOCTYPE html>
			<html lang="en">
			<head>
				<meta charset="UTF-8">
				<script>
				// This is needed for various older packages that require the global
				// object to be defined because it typically was with older bundlers like
				// webpack
				var global = window;
			  </script>
				
				<meta name="viewport" content="width=device-width, initial-scale=1.0">

				
				<link href="${o}" rel="stylesheet" />
				
				<title>Shiny UI Editor</title>
			</head>
			<body style="padding-inline: 0;">
				<noscript>You need to enable JavaScript to run this app.</noscript>
				<div id="root" style="height: 100vh; display: relative"></div>
				<script type="module" nonce="${n}" src="${t}"></script>
			</body>
			</html>`}},F=W;F.viewType="shinyuieditor.appFile";function vt(){let r="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<32;t++)r+=e.charAt(Math.floor(Math.random()*e.length));return r}function Et(r){r.subscriptions.push(F.register(r)),r.subscriptions.push(q.commands.registerCommand("shinyuieditor.startEditorOnActiveFile",te),q.commands.registerCommand("shinyuieditor.launchEditor",J))}0&&(module.exports={activate});
